<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="UTF-8">
        <title>Exercice SQL - Bureaux</title>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/sql-wasm.js"></script>
        <style>
            body {
                font-family: Arial, sans-serif;
                margin: 2em;
                background-color: #f9f9f9;
            }
            textarea {
                width: 100%;
                height: 100px;
                margin-top: 1em;
                font-family: monospace;
            }
            button {
                margin-top: 1em;
                padding: 10px 20px;
                font-weight: bold;
            }
            table {
                margin-top: 1em;
                border-collapse: collapse;
                width: 100%;
            }
            th, td {
                border: 1px solid #ccc;
                padding: 8px;
                text-align: left;
            }
            .result {
                margin-top: 1em;
                font-weight: bold;
            }
        </style>
    </head>
    <body>
        <h1>Exercice SQL</h1>
        <p><strong>Énoncé :</strong> Écrivez une requête pour afficher tous les bureaux de l'entreprise.</p>

        <textarea id="sql-input" placeholder="Écrivez ici votre requête SQL..."></textarea><br>
        <button onclick="executerRequete()">Exécuter</button>

        <div id="resultat" class="result"></div>
        <div id="table-container"></div>

        <script>
            let db;

            initSqlJs({ locateFile: file => `https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/${file}` })
                .then(SQL => {
                    fetch("bureaux.sqlite")
                        .then(res => res.arrayBuffer())
                        .then(buffer => {
                            db = new SQL.Database(new Uint8Array(buffer));
                        });
                });

            function executerRequete() {
                const input = document.getElementById("sql-input").value.trim();
                const resultatDiv = document.getElementById("resultat");
                const tableDiv = document.getElementById("table-container");
                tableDiv.innerHTML = "";
                resultatDiv.textContent = "";

                try {
                    const res = db.exec(input);

                    if (input.toUpperCase().replace(/\s+/g, '') === "SELECT*FROMBUREAUX;") {
                        resultatDiv.style.color = "green";
                        resultatDiv.textContent = "Bonne réponse !";
                    } else {
                        resultatDiv.style.color = "orange";
                        resultatDiv.textContent = "Requête exécutée, mais ce n'est pas exactement la réponse attendue.";
                    }

                    if (res.length > 0) {
                        const columns = res[0].columns;
                        const values = res[0].values;

                        const table = document.createElement("table");
                        const thead = table.insertRow();
                        columns.forEach(col => {
                            const th = document.createElement("th");
                            th.textContent = col;
                            thead.appendChild(th);
                        });

                        values.forEach(row => {
                            const tr = table.insertRow();
                            row.forEach(cell => {
                                const td = tr.insertCell();
                                td.textContent = cell;
                            });
                        });

                        tableDiv.appendChild(table);
                    }
                } catch (e) {
                    resultatDiv.style.color = "red";
                    resultatDiv.textContent = "Erreur : " + e.message;
                }
            }
        </script>
    </body>
</html>
